<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    /* ===== iOS Liquid Glass Base ===== */
    :root{
      --glass-bg: rgba(255,255,255,0.22);
      --glass-stroke: rgba(255,255,255,0.45);
      --glass-shadow: 0 18px 50px rgba(0,0,0,0.25);
      --glass-radius: 22px;
      --ring-blue: rgba(60,130,255,0.55);
      --ring-green: rgba(46,184,76,0.50);
      --text-strong: #0b0f13;
      --text-weak: rgba(11,15,19,0.7);
    }

    /* Body fills extension popup */
    body {
      width: 440px;
      min-height: 540px;
      max-height: 600px;
      margin: 0;
      padding: 0;
      /* Subtle gradient background visible through the glass */
      background: 
        linear-gradient(135deg, 
          rgba(255, 182, 193, 0.2) 0%,
          rgba(173, 216, 230, 0.2) 25%,
          rgba(221, 160, 221, 0.2) 50%,
          rgba(255, 218, 185, 0.2) 75%,
          rgba(176, 224, 230, 0.2) 100%
        ),
        linear-gradient(145deg, #e5e7f0 0%, #d8dce8 100%);
      overflow: hidden;
    }

    /* Optional ambient gradient behind the glass to add depth */
    .glass-ambient{
      position: absolute;
      inset: 0;
      z-index: 1;
      pointer-events: none;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(140,180,255,0.35), transparent 60%),
                  radial-gradient(900px 700px at 80% 30%, rgba(255,140,200,0.32), transparent 60%),
                  radial-gradient(900px 700px at 40% 90%, rgba(160,255,210,0.28), transparent 60%);
      filter: saturate(120%) contrast(105%);
    }

    /* Main floating panel */
    .glass-panel{
      position: relative;
      z-index: 2;
      margin: 20px;
      max-height: calc(100vh - 40px);
      overflow-y: auto;
      overflow-x: hidden;

      /* Glass core */
      background: var(--glass-bg);
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);

      border-radius: var(--glass-radius);
      box-shadow: var(--glass-shadow);
      border: 1px solid var(--glass-stroke);

      /* Soft highlight edge */
      outline: 1px solid rgba(255,255,255,0.18);
      outline-offset: -1px;

      /* Inner padding/layout */
      padding: 22px 22px 18px;
      color: var(--text-strong);
      font: 500 14px/1.4 ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    .glass-panel h1, .glass-panel h2, .glass-panel h3{
      margin: 0 0 14px;
      font-weight: 800;
      letter-spacing: -0.01em;
      color: var(--text-strong);
      text-shadow: 0 1px 0 rgba(255,255,255,0.35);
    }

    .glass-section{ margin-top: 14px; }

    /* Status / info pill */
    .glass-pill{
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      border-radius: 16px;
      background: rgba(230,255,235,0.35);
      backdrop-filter: blur(16px) saturate(140%);
      -webkit-backdrop-filter: blur(16px) saturate(140%);
      border: 1px solid rgba(255,255,255,0.5);
      box-shadow: 0 6px 20px rgba(46,184,76,0.18) inset, 0 4px 14px rgba(0,0,0,0.06);
      color: var(--text-strong);
      font-size: 14px;
      font-weight: 600;
      transition: all 0.25s ease;
    }

    .glass-pill.error{
      background: rgba(255,235,235,0.40);
      box-shadow: 0 6px 20px rgba(255,59,48,0.18) inset, 0 4px 14px rgba(0,0,0,0.06);
      border-color: rgba(255,100,100,0.5);
      color: #c81e1e;
    }

    /* Inputs / textarea */
    .glass-input{
      width: 100%;
      min-height: 120px; /* for textarea */
      padding: 14px 16px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.6);
      background: rgba(255,255,255,0.20);
      backdrop-filter: blur(18px) saturate(170%);
      -webkit-backdrop-filter: blur(18px) saturate(170%);
      box-shadow: 0 8px 24px rgba(76,140,255,0.12), 0 2px 6px rgba(0,0,0,0.05) inset;
      color: var(--text-strong);
      font-family: inherit;
      font-size: 15px;
      line-height: 1.6;
      resize: vertical;
      outline: none;
      transition: box-shadow .25s ease, background .25s ease, border-color .25s ease, transform .12s ease;
    }
    .glass-input::placeholder{ 
      color: var(--text-weak); 
      font-weight: 500;
    }
    .glass-input:focus{
      border-color: rgba(60,130,255,0.65);
      box-shadow: 0 0 0 6px rgba(60,130,255,0.18), 0 10px 28px rgba(60,130,255,0.22);
      transform: translateY(-1px);
    }

    /* Buttons */
    .glass-actions{ 
      display: grid; 
      grid-template-columns: 1fr 1fr; 
      gap: 14px; 
    }
    
    .glass-button{
      appearance: none; -webkit-appearance: none;
      display: inline-flex; align-items: center; justify-content: center;
      gap: 10px; width: 100%;
      padding: 12px 16px;
      font-weight: 700; 
      font-size: 16px;
      letter-spacing: 0.2px;
      border-radius: 16px;
      border: 1px solid rgba(255,255,255,0.55);
      background: rgba(255,255,255,0.18);
      backdrop-filter: blur(16px) saturate(170%);
      -webkit-backdrop-filter: blur(16px) saturate(170%);
      color: var(--text-strong);
      box-shadow: 0 10px 28px rgba(0,0,0,0.12), 0 1px 0 rgba(255,255,255,0.6) inset;
      cursor: pointer;
      transition: transform .08s ease, box-shadow .25s ease, background .25s ease, border-color .25s ease;
    }
    .glass-button:hover:not(:disabled){
      transform: translateY(-1px);
      background: rgba(255,255,255,0.24);
    }
    .glass-button:active:not(:disabled){ 
      transform: translateY(0); 
    }
    .glass-button:focus-visible{
      outline: 0; box-shadow: 0 0 0 6px rgba(60,130,255,0.18);
    }
    .glass-button:disabled{
      opacity: 0.5;
      cursor: not-allowed;
      background: rgba(180,180,180,0.18);
      color: rgba(60,60,67,0.4);
    }

    /* Color accents */
    .glass-button.is-blue{
      border-color: rgba(60,130,255,0.55);
      box-shadow: 0 10px 28px rgba(60,130,255,0.20), 0 1px 0 rgba(255,255,255,0.6) inset;
    }
    .glass-button.is-blue:hover:not(:disabled){
      box-shadow: 0 12px 34px rgba(60,130,255,0.28);
    }
    .glass-button.is-green{
      border-color: rgba(46,184,76,0.55);
      box-shadow: 0 10px 28px rgba(46,184,76,0.20), 0 1px 0 rgba(255,255,255,0.6) inset;
    }
    .glass-button.is-green:hover:not(:disabled){
      box-shadow: 0 12px 34px rgba(46,184,76,0.28);
    }

    /* Results area as glass panel */
    .glass-output{
      margin-top: 14px;
      min-height: 120px;
      max-height: 220px;
      padding: 16px;
      border-radius: 18px;
      border: 1px solid rgba(255,255,255,0.55);
      background: rgba(255,255,255,0.16);
      backdrop-filter: blur(16px) saturate(170%);
      -webkit-backdrop-filter: blur(16px) saturate(170%);
      box-shadow: 0 6px 22px rgba(0,0,0,0.10) inset, 0 10px 28px rgba(0,0,0,0.10);
      color: var(--text-strong);
      font-size: 14.5px;
      line-height: 1.7;
      white-space: pre-wrap;
      word-wrap: break-word;
      overflow-y: auto;
    }

    .glass-output.error{
      background: rgba(255,240,240,0.25);
      border-color: rgba(255,100,100,0.5);
      color: #c81e1e;
      box-shadow: 0 6px 22px rgba(255,59,48,0.12) inset, 0 10px 28px rgba(0,0,0,0.08);
    }

    .glass-output.loading{
      font-style: italic;
      color: var(--text-weak);
      animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    /* Scrollbar styling */
    .glass-output::-webkit-scrollbar,
    .glass-panel::-webkit-scrollbar {
      width: 10px;
    }
    .glass-output::-webkit-scrollbar-track,
    .glass-panel::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.2);
      border-radius: 12px;
      margin: 6px;
    }
    .glass-output::-webkit-scrollbar-thumb,
    .glass-panel::-webkit-scrollbar-thumb {
      background: linear-gradient(135deg, rgba(0, 122, 255, 0.3) 0%, rgba(0, 122, 255, 0.25) 100%);
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.4);
      background-clip: padding-box;
    }
    .glass-output::-webkit-scrollbar-thumb:hover,
    .glass-panel::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(135deg, rgba(0, 122, 255, 0.45) 0%, rgba(0, 122, 255, 0.4) 100%);
    }

    /* Subtle glow ring around the whole panel (like iOS widgets) */
    .glass-panel::before{
      content: "";
      position: absolute; inset: -1px;
      border-radius: inherit;
      pointer-events: none;
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.22) inset,
        0 0 60px rgba(90,150,255,0.20) inset,
        0 0 70px rgba(255,140,200,0.18) inset;
      z-index: 1;
    }

    /* Ensure content is above ::before */
    .glass-panel > * {
      position: relative;
      z-index: 2;
    }

    /* Layout helpers */
    .mt-12{ margin-top:12px; } 
    .mt-16{ margin-top:16px; }

    /* Settings-specific styles */
    .glass-section {
      padding-top: 16px;
      border-top: 1px solid rgba(255,255,255,0.2);
    }

    .glass-section:first-of-type {
      border-top: none;
    }

    .glass-section h3 {
      font-size: 15px;
      font-weight: 700;
      margin-bottom: 12px;
      color: var(--text-strong);
    }

    .help-text {
      font-size: 13px;
      line-height: 1.6;
      color: var(--text-weak);
      margin: 0;
    }

    kbd {
      display: inline-block;
      padding: 3px 7px;
      font-size: 12px;
      font-family: ui-monospace, monospace;
      background: rgba(255,255,255,0.3);
      border: 1px solid rgba(255,255,255,0.5);
      border-radius: 6px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      font-weight: 600;
    }

    .settings-label {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      font-size: 14px;
      font-weight: 500;
      color: var(--text-strong);
    }

    .toggle-checkbox {
      width: 44px;
      height: 24px;
      appearance: none;
      background: rgba(120,120,128,0.3);
      border-radius: 12px;
      position: relative;
      cursor: pointer;
      transition: background 0.3s ease;
      border: 1px solid rgba(255,255,255,0.4);
    }

    .toggle-checkbox:checked {
      background: rgba(46,184,76,0.6);
    }

    .toggle-checkbox::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background: white;
      top: 1px;
      left: 1px;
      transition: transform 0.3s ease;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    .toggle-checkbox:checked::before {
      transform: translateX(20px);
    }

    .glass-select {
      padding: 8px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.6);
      background: rgba(255,255,255,0.2);
      backdrop-filter: blur(16px) saturate(170%);
      -webkit-backdrop-filter: blur(16px) saturate(170%);
      color: var(--text-strong);
      font-family: inherit;
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      outline: none;
      min-width: 150px;
    }

    .glass-select:focus {
      border-color: rgba(60,130,255,0.65);
      box-shadow: 0 0 0 4px rgba(60,130,255,0.15);
    }

    .glass-input.small {
      min-height: 80px;
      font-size: 13px;
    }

    .slider {
      flex: 1;
      height: 6px;
      border-radius: 3px;
      background: rgba(255,255,255,0.3);
      outline: none;
      appearance: none;
      -webkit-appearance: none;
    }

    .slider::-webkit-slider-thumb {
      -webkit-appearance: none;
      appearance: none;
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(60,130,255,0.9);
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .slider::-moz-range-thumb {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      background: rgba(60,130,255,0.9);
      cursor: pointer;
      border: none;
      box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    }

    .slider-value {
      min-width: 40px;
      text-align: right;
      font-weight: 600;
      font-size: 13px;
      color: var(--text-strong);
    }

    .glass-message {
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 500;
      text-align: center;
    }

    .glass-message.success {
      background: rgba(230,255,235,0.4);
      border: 1px solid rgba(46,184,76,0.5);
      color: #2e8b57;
    }

    .glass-message.error {
      background: rgba(255,235,235,0.4);
      border: 1px solid rgba(255,100,100,0.5);
      color: #c81e1e;
    }

    /* Fallback for browsers without backdrop-filter */
    @supports not ((backdrop-filter: blur(1px)) or (-webkit-backdrop-filter: blur(1px))){
      .glass-panel, .glass-input, .glass-button, .glass-output, .glass-pill{
        background: rgba(255,255,255,0.88);
      }
    }
    /* === Neutral overrides (no colored gradients) === */
    /* POPUP BACKGROUND MUST BE NEUTRAL/TRANSPARENT */
    html, body {
      background: transparent !important;
    }
    
    /* Remove ambient color wash */
    .glass-ambient { display: none !important; }
    
    /* Neutral, premium iOS glass */
    :root{
      --glass-bg: rgba(255,255,255,0.18);
      --glass-stroke: rgba(255,255,255,0.50);
      --glass-shadow: 0 22px 60px rgba(0,0,0,0.22);
      --glass-radius: 22px;
      --text-strong: #0b0f13;
      --text-weak: rgba(11,15,19,0.64);
    }
    
    .glass-panel{
      background: var(--glass-bg) !important;
      -webkit-backdrop-filter: blur(24px) saturate(180%) !important;
      backdrop-filter: blur(24px) saturate(180%) !important;
      border: 1px solid var(--glass-stroke) !important;
      box-shadow: var(--glass-shadow) !important;
    }
    
    /* Remove the pink/blue inset glow ring */
    .glass-panel::before{
      box-shadow:
        0 0 0 1px rgba(255,255,255,0.24) inset !important;
    }
    
    /* Controls stay glass but neutral */
    .glass-input,
    .glass-output,
    .glass-button{
      background: rgba(255,255,255,0.18) !important;
      -webkit-backdrop-filter: blur(18px) saturate(170%) !important;
      backdrop-filter: blur(18px) saturate(170%) !important;
      border: 1px solid rgba(255,255,255,0.55) !important;
      color: var(--text-strong) !important;
    }
    
    /* Accent only via border glow (no filled color) */
    .glass-button.is-blue{ box-shadow: 0 10px 28px rgba(60,130,255,0.14); border-color: rgba(60,130,255,0.55); }
    .glass-button.is-green{ box-shadow: 0 10px 28px rgba(46,184,76,0.14); border-color: rgba(46,184,76,0.55); }
    
    .glass-button:hover{ background: rgba(255,255,255,0.24) !important; }
  </style>
</head>
<body>
  <div class="glass-ambient"></div>
  
  <div class="glass-panel">
    <h1>🌱 Envairo Settings</h1>

    <div id="status" class="glass-pill mt-12">Checking AI availability...</div>

    <!-- Quick Start -->
    <div class="glass-section mt-16">
      <h3>Quick Start</h3>
      <p class="help-text">Press <kbd>Cmd+Shift+Y</kbd> (Mac) or <kbd>Ctrl+Shift+Y</kbd> (Windows/Linux) to toggle the Sustainability Advisor overlay on product pages.</p>
      <button id="testOverlayBtn" class="glass-button is-blue mt-12">Toggle Overlay</button>
    </div>

    <!-- Overlay Settings -->
    <div class="glass-section mt-16">
      <h3>Overlay Settings</h3>
      
      <label class="settings-label">
        <span>Show Overlay on Startup</span>
        <input type="checkbox" id="showOnStartup" class="toggle-checkbox">
      </label>

      <label class="settings-label mt-12">
        <span>Overlay Position</span>
        <select id="overlayPosition" class="glass-select">
          <option value="top-right">Top Right</option>
          <option value="top-left">Top Left</option>
          <option value="bottom-right">Bottom Right</option>
          <option value="bottom-left">Bottom Left</option>
          <option value="center">Center</option>
        </select>
      </label>
    </div>

    <!-- AI Model Settings -->
    <div class="glass-section mt-16">
      <h3>AI Model Settings</h3>
      
      <label class="settings-label">
        <span>System Prompt</span>
        <textarea id="systemPrompt" class="glass-input small" placeholder="You are a helpful assistant...">You are a helpful AI assistant integrated into the browser. Provide concise, accurate, and friendly responses.</textarea>
      </label>

      <label class="settings-label mt-12">
        <span>Temperature</span>
        <input type="range" id="temperature" class="slider" min="0" max="1" step="0.1" value="0.7">
        <span class="slider-value" id="tempValue">0.7</span>
      </label>

      <label class="settings-label mt-12">
        <span>Top K</span>
        <input type="range" id="topK" class="slider" min="1" max="100" step="1" value="40">
        <span class="slider-value" id="topKValue">40</span>
      </label>
    </div>

    <!-- Privacy & Data -->
    <div class="glass-section mt-16">
      <h3>Privacy & Data</h3>
      
      <label class="settings-label">
        <span>Save Conversation History</span>
        <input type="checkbox" id="saveHistory" class="toggle-checkbox" checked>
      </label>

      <button id="clearHistoryBtn" class="glass-button mt-12">Clear History</button>
    </div>

    <!-- About -->
    <div class="glass-section mt-16">
      <h3>About</h3>
      <p class="help-text">Envairo - Sustainability Product Advisor v1.0.0</p>
      <p class="help-text mt-12">Uses Chrome's Built-in AI Prompt API to provide sustainability insights for products.</p>
      <button id="checkUpdatesBtn" class="glass-button mt-12">Check for Updates</button>
    </div>

    <!-- Footer Actions -->
    <div class="glass-actions mt-16">
      <button id="resetBtn" class="glass-button">Reset to Defaults</button>
      <button id="saveBtn" class="glass-button is-green">Save Settings</button>
    </div>

    <div id="message" class="glass-message mt-12" style="display:none;"></div>
  </div>

  <script src="./popup.js"></script>
</body>
</html>
